version: "3.7"

services:
  api:
    image: chainforensics/chainforensics-api:v3.1.0@sha256:placeholder
    restart: on-failure
    stop_grace_period: 1m
    user: "1000:1000"
    environment:
      DEBUG: "false"
      API_PORT: "3000"
      DATABASE_URL: "sqlite+aiosqlite:///./data/chainforensics.db"
      # Bitcoin Core RPC - connects to Umbrel's Bitcoin node
      BITCOIN_RPC_HOST: "${APP_BITCOIN_NODE_IP}"
      BITCOIN_RPC_PORT: "8332"
      BITCOIN_RPC_USER: "${APP_BITCOIN_RPC_USER}"
      BITCOIN_RPC_PASS: "${APP_BITCOIN_RPC_PASS}"
      BITCOIN_RPC_TIMEOUT: "60"
      # Fulcrum (optional - for enhanced features)
      FULCRUM_HOST: "${APP_FULCRUM_HOST:-}"
      FULCRUM_PORT: "${APP_FULCRUM_PORT:-50001}"
      # Analysis settings
      MAX_TRACE_DEPTH: "50"
      DEFAULT_TRACE_DEPTH: "10"
      ENABLE_BACKGROUND_INDEXER: "true"
    volumes:
      - ${APP_DATA_DIR}/data:/app/data
    networks:
      default:
        ipv4_address: $APP_CHAINFORENSICS_API_IP

  web:
    image: chainforensics/chainforensics-web:v3.1.0@sha256:placeholder
    restart: on-failure
    stop_grace_period: 30s
    environment:
      APP_CHAINFORENSICS_API_IP: "${APP_CHAINFORENSICS_API_IP}"
    depends_on:
      - api
    ports:
      - "${APP_CHAINFORENSICS_WEB_PORT}:80"
    networks:
      default:
        ipv4_address: $APP_CHAINFORENSICS_WEB_IP
